gbl.ns.register("idp.shopper");idp.shopper.create=function(){var a=$idp("#create-account");var G=null;var H=null;var E=null;var m=null;var K=null;var J=null;var z=null;var k=null;var r=false;var x=null;var u=[["pw-oucl",""],["pw-alc",/.{9,}/]];var v;var t=a.find("#password1");var g=a.find("#password2");var q=new RegExp(/[<>;()]+/g);this.init=function(W,P,O,N,X,R,Q,V,T,S,M,U,L){G=W;E=O;H=P;m=N;K=X;z=V;k=M;x=T;u[0][1]=new RegExp(U);v=S;b();B();if(Q!="True"){c(R)}else{$idp("#idp-createShopperPopup .fieldHeaderTitle").css({position:"relative"})}if(L==="false"){C(false)}};var b=function(){a.find("#submit").click(function(){var L=a.find("#utos_error");if(a.find("#agree_tos").is(":checked")){a.submit();L.hide()}else{L.show();$idp.scrollTo("#utos_error",250,{offset:-50})}return false});a.find('input[name="surveyChoices"]').bind("change",function(){var M=a.find("#survey-tv-types");var L=a.find("#survey-event-types");if(this.id=="survey-tv-rb"){M.show();L.hide()}else{if(this.id=="survey-event-rb"){M.hide();L.show()}else{M.hide();L.hide()}}});a.find("#country").bind("change",function(){var L=a.find("#country option:selected");var N=L.val();var M=L.data("country-id");if(N!=""){o(N,M);p(N)}});a.find("#state_other").blur(function(){var N=true;var M=a.find("#country option:selected").val();if(M==="cn"){var O=a.find("#state_other").val();if(O.toLowerCase()==="hong kong"){N=false}}else{if(M==="hk"){N=false}}var L=a.find("#zip_required");var P=a.find("#zip");if(N){L.show();P.rules("add",{required:true})}else{L.hide();P.rules("remove");y(P)}});a.find(".input-t").bind("keyup.cleanForm blur.cleanForm",function(){f($idp(this))});a.find("#hint").unbind("keyup.cleanForm blur.cleanForm");a.find("#password1").unbind("keyup.cleanForm blur.cleanForm");a.find("#password2").unbind("keyup.cleanForm blur.cleanForm");a.find("#birthmonth").bind("change",function(){var L=a.find("#birthday option");var P=$idp(this).val();var O=parseInt($idp($idp(L).filter(":selected")[0]).attr("value"));var M=0;if(P.length>0){switch(P){case"2":M=2;break;case"4":case"6":case"9":case"11":M=1;break}}var N=L.slice(30,32);switch(M){case 0:N.show();N.removeAttr("disabled");break;case 1:$idp(N[0]).show();$idp(N[0]).removeAttr("disabled");$idp(N[1]).hide();$idp(N[1]).attr("disabled","disabled");break;case 2:N.hide();N.attr("disabled","disabled");break}if(O+M>31){$idp(L[0]).attr("selected","selected")}});a.find(".g-modal-close, #modal-f-close").click(function(){$idp.modal.close();return false});a.find("#utos, #utos-modal").click(function(){s("utos","utos-html","modal-h-utos")});a.find("#privacy, .trust_e").click(function(){s("privacy","privacy-html","modal-h-privacy")});a.find(".verified").click(function(){var L=window.open(K,"verified","width=500, scrollbars=0, menu=0, status=1");L.resizeTo(500,900)});a.find("#print-modal").click(function(){$idp(this).next().printElement()})};var c=function(M){var L=$idp(M);a.find("#utos-message").html(L.html());a.find("#utos-message").bind("scroll",function(){i()});a.find("#first_name").bind("keydown",function(){i()})};var i=function(){var L=$idp("#utos-html");if(L.html()==""){l("utos",L,"utosScrollBox")}else{a.find("#utos-message").html(L.html())}a.find("#utos-message").unbind("scroll");a.find("#first_name").unbind("keydown")};var s=function(L,M,N){M=a.find("#"+M);a.find(".g-modal-header").hide();a.find("#"+N).show();var O=M.html();if(O==""){l(L,M,"modal")}else{A(O)}};var o=function(O,N){var M=a.find("#state");var L=a.find("#state_other");$.ajax({type:"POST",dataType:"json",url:E,data:{countryId:N},success:function(P){C(P.HasStates,O);if(P.HasStates){M.html(P.StateHtml)}},error:function(){M.hide();L.show()}})};var C=function(Q,P){var M=a.find("#state");var L=a.find("#state_other");var O=a.find("#zip_required");var N=a.find("#zip");if(P===null){var R=a.find("#country option:selected");P=R.val()}if(Q){M.show();L.hide();L.val("");L.rules("remove");M.rules("add",{stateRequired:true})}else{if(!L.is(":visible")){L.val("")}M.hide();L.show();M.rules("remove");L.rules("add",{stateRequired:true})}if(P!="hk"){O.show();N.rules("add",{required:true})}else{O.hide();N.rules("remove")}y(L);y(N)};var p=function(P){var L=a.find("#survey-tv-types");var N=L.find("option:selected");var O=N.length>0?N.val().split(",")[0]:"";if(O!==""){var M=N.val().split(",")[1];if(M==="1"){O=""}}$.ajax({type:"POST",dataType:"json",url:H,data:{countryCode:P,selectedSurveyType:O},success:function(Q){L.html(Q.SurveyHtml);var R=$idp("option",L).length;a.find(".idp-survey-selector").each(function(){var U=$(this).val().split(",");var S=R+1;var T=U[0]+","+S;$(this).val(T);R++})}})};var l=function(N,O,L){showModal=typeof showModal!="undefined"?showModal:true;var M="";$idp.ajax({type:"POST",dataType:"json",url:m,data:{docType:N},success:function(P){O.html(P.DocumentHtml);if(L=="modal"){A(P.DocumentHtml)}else{if(L=="utosScrollBox"){a.find("#utos-message").html(P.DocumentHtml)}}}})};var A=function(L){var M=$idp(a.find("#utos-modal-message .g-modal-content p"));M.html(L);a.find("#utos-modal-message").modal({overlayId:"g-modal-overlay",close:"false",autoPosition:"true"})};var y=function(L){var M=L.parent();M.children().removeClass("error");M.children("label").hide()};var f=function(L){var M=L.val();if(M.length>0){if(q.test(M)){M=M.replace(q,"");L.val(M)}}};var j=function(){var L=a.serializeArray();h(L,"password1");h(L,"password2");h(L,"hint");return L};var h=function(L,M){var N=n(L,M);if(N>-1){L[N].value=encodeURIComponent(L[N].value)}};var n=function(L,M){for(var N=0;N<L.length;N++){if(L[N].name==M){return N}}return -1};t.focus(function(){e(this);var L=t.position().top;$idp("#pwInfo").css({top:L-10+"px"}).fadeIn(150);$idp("#pwInfo").fadeIn(150)});t.blur(function(){$idp("#pwInfo").fadeOut(150)});t.keyup(function(){e(this)});g.focus(function(){d();var L=g.position().top;$idp("#confirmPwInfo").css({top:L-10+"px"}).fadeIn(150)});g.blur(function(){$idp("#confirmPwInfo").fadeOut(150)});g.keyup(function(){d()});var I=function(M,L){if(!M){$idp("#"+L+" .checkmark_circle").removeClass("checkmark_circle").addClass("redx_circle")}else{$idp("#"+L+" .redx_circle").removeClass("redx_circle").addClass("checkmark_circle")}};var e=function(){var N=t.val();var O;var M=u.length;for(var L=0;L<M;L++){O=u[L];I(O[1].test(N),O[0])}};var d=function(){I(g.val()==t.val(),"confirmPwInfo")};var B=function(){$idp.validator.addMethod("stateRequired",D,z);$idp.validator.addMethod("pwIsValid",w,v);J=a.validate({rules:{first_name:{required:true},last_name:{required:true},email:{required:true},address1:{required:true},city:{required:true},state:{stateRequired:true},work_phone:{required:true},username:{required:true},password1:{required:true,minlength:9,pwIsValid:true},password2:{required:true,equalTo:"#password1"},hint:{required:true},pin:{required:true,number:true,minlength:4},zip:{required:true},ext:{number:true}},messages:{first_name:{required:z},last_name:{required:z},state:{stateRequired:z},work_phone:{required:z},username:{required:z},password1:{required:z,pwIsValid:v},password2:{required:z,equalTo:x},hint:{required:z},pin:{required:z},zip:{required:z}},highlight:function(M,N){var L=$idp(M);L.prevAll(".label-t").addClass(N);L.addClass(N)},unhighlight:function(M,N){var L=$idp(M);if(L.is(":visible")){L.prevAll(".label-t").removeClass(N)}L.removeClass(N)},submitHandler:function(L){if(!r){r=true;a.find("#submit").addClass("g-btn-prg-inactive");$idp.ajax({type:"POST",url:G,dataType:"json",data:j(),success:F,error:function(O,N,M){r=false;a.find("#submit").removeClass("g-btn-prg-inactive");alert(k)}})}}})};var D=function(O,L){var N=a.find("#state_other").is(":visible");var M=false;if(!N){M=L.id=="state_other"||O.length>0}else{M=O.length>0}return M};var w=function(Q,L){var R=false;var O=t.val();var P;var N=u.length;for(var M=0;M<N;M++){P=u[M];R=P[1].test(O);if(!R){break}}return R};var F=function(L){r=false;if(L.success){window.location=L.redirectUrl}else{if(L.error){a.find("#submit").removeClass("g-btn-prg-inactive");alert(L.error)}else{a.find("#submit").removeClass("g-btn-prg-inactive");a.validate().showErrors(L);var M=a.find("label.error").first().prev().attr("id");$idp.scrollTo("#"+M,250,{offset:-50})}}}};